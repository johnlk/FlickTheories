<!DOCTYPE HTML>
<html>
	<head>
		<title>Movie Thoughts Blog by John Kuhn</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<!--[if lte IE 8]><script src="assets/js/ie/html5shiv.js"></script><![endif]-->
		<link rel="stylesheet" href="../assets/css/main.css" />
		<!--[if lte IE 9]><link rel="stylesheet" href="../assets/css/ie9.css" /><![endif]-->
		<!--[if lte IE 8]><link rel="stylesheet" href="../assets/css/ie8.css" /><![endif]-->

		<script src="https://www.gstatic.com/firebasejs/4.0.0/firebase.js"></script>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
	</head>
	<body>
  
		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<div id="main">
						<div class="inner">
						  
						  <div class="loginButtons">
								<ul class="actions">
									<li><input id="logout" name="logout" type="submit" value="Logout" /></li>
								</ul>
						  </div>
						  

							<!-- Header -->
								<header id="header">
									<span><strong>Movie</strong> Thoughts</span>
									<h3 class="pageDeclaration">Edit and add Articles</h3>
								</header>
								
							<!-- Section -->
							<section>
							  <div class="addAnArticle">
							    <h3>New Article</h3>
  							   <div class="row uniform">
                    <div class="6u 12u$(xsmall)">
  										<input type="text" name="articleTitle" id="demo-name" value="" placeholder="Article Title" />
  									</div>
  									<div class="6u 12u$(xsmall)">
  									  <div id="search" style="margin-bottom: -5%;">
    									  <form method="post" onsubmit="return false">
        									<input type="text" name="query" id="query" placeholder="Movie Search" />
        								</form>
      								</div>
  									</div>
  								</div>
  								<div class="row uniform">
  									<div class="6u$ 12u$(xsmall)">
  										<input type="text" name="author" value="" placeholder="Signing Author" />
  									</div>
  									<div class="12u$">
  										<textarea name="articleText" id="demo-message" placeholder="Article Text ..." rows="10"></textarea>
  									</div>
  									<div class="12u$">
  										<ul class="actions">
  									  	<li><input name="submit" type="submit" value="Submit Article" class="special" /></li>
  										</ul>
  									</div>
  								</div>
							  </div>
							</section>

						</div>
					</div>

			</div>

		<!-- Scripts -->
			<script src="../assets/js/jquery.min.js"></script>
			<script src="../assets/js/skel.min.js"></script>
			<script src="../assets/js/util.js"></script>
			<!--[if lte IE 8]><script src="../assets/js/ie/respond.min.js"></script><![endif]-->
			<script src="../assets/js/main.js"></script>

			<script src="../assets/js/movieFireApp.js"></script>
			<script>
			  // Initialize Firebase
			  var config = {
			    apiKey: "AIzaSyCwNaBXbDWunUuT5HuMzxgQRNF0ByOiq04",
			    authDomain: "moviethoughts-d188d.firebaseapp.com",
			    databaseURL: "https://moviethoughts-d188d.firebaseio.com",
			    projectId: "moviethoughts-d188d",
			    storageBucket: "moviethoughts-d188d.appspot.com",
			    messagingSenderId: "923578276783"
			  };
			  firebase.initializeApp(config);
			</script>
			<script type="text/javascript">
        $(document).ready(function () {
          
          firebase.auth().onAuthStateChanged(function (user) {
            if (!user) {
              window.location.replace('login.html');
            }

            //want to replace with cloud function call
            var uid = "URiRTmp97VhR1mU7Gss2ACmep9J3";

            if(user.uid != uid){
              window.location.replace('login.html');
            }

          });
          
          $('#logout').on('click', function(){
            console.log('eyah');
            window.fireApp.signOut();
            window.location.replace('login.html');
          });

          $('input[name="submit"]').on('click', function(){
            
            var articleTitle = $('input[name="articleTitle"]').val();
            var author = $('input[name="author"]').val();
            var articleText = $('textarea').val();
            
            var date = new Date().getTime() + "";
            
            if(!isFilled($('input[name="articleTitle"]')) || !isFilled($('input[name="author"]')) || !isFilled($('textarea'))){
              return;
            }
            
            firebase.auth().onAuthStateChanged(function (user) {
              if (user) {//if we are signed in
                window.fireApp.addArticle({
                  articleText: articleText,
                  articleTitle: articleTitle,
                  author: author,
                  movieTitle: "Generic Movie",
                  movieGenre: "unknown",
                  movieYear: "unknown",
                  userUID: user.uid,
                  dateCreated: date
                });
                
                alert('success');
                $('input[name="articleTitle"]').val('');
                $('input[name="author"]').val('');
                $('textarea').val('');
              }
            });
            
          });
          
          function isFilled(element){
            var text = element.val();
            if(text.length < 1){
              element.css('border', '2px solid red');
              element.css('color', 'red');
              element.val('please complete this section');
              element.on('click', function(){
                element.val('');
                element.css('border-color', 'rgba(210, 215, 217, 0.75)');
                element.css('color', 'rgb(127, 136, 143)');
              });
              return false;
            }
            return true;
          }

				});
			</script>

	</body>
</html>